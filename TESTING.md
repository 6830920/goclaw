# Goclaw 测试系统

## 🧪 概述

Goclaw项目包含全面的测试系统，确保代码质量和功能稳定性。测试系统包括单元测试、集成测试和实时服务器测试。

## 📋 测试类型

### 1. 单元测试
- **向量存储测试**: 测试向量存储和检索功能
- **定时任务测试**: 测试Cron任务管理功能
- **并发访问测试**: 测试多线程安全性
- **数据持久化测试**: 测试数据保存和加载功能

### 2. 集成测试
- **API端点测试**: 测试所有REST API端点
- **服务启动测试**: 测试服务器正常启动
- **健康检查测试**: 测试服务健康状态

### 3. 实时测试
- **测试服务器**: 专用测试服务器（端口55790）
- **实时验证**: 实时测试代码修改效果

## 🛠️ 测试工具

### test_server.sh 脚本
```bash
# 构建服务器
./test_server.sh build

# 启动测试服务器
./test_server.sh start

# 停止测试服务器
./test_server.sh stop

# 运行单元测试
./test_server.sh test-unit

# 运行API测试
./test_server.sh test-api

# 重新加载并测试
./test_server.sh reload

# 完整测试流程
./test_server.sh full-test
```

### 菜单模式
```bash
./test_server.sh
```

## 📊 测试覆盖范围

### 向量存储 (internal/vector)
- [x] 添加和搜索功能
- [x] 嵌入功能测试
- [x] 相关性搜索测试
- [x] 数据持久化测试
- [x] 并发访问测试

### 定时任务 (internal/cron)
- [x] 基本操作测试
- [x] 任务调度测试
- [x] 禁用任务测试
- [x] 任务更新测试
- [x] 多任务管理测试
- [x] 任务执行测试
- [x] 无效调度测试

### API端点
- [x] 健康检查 `/health`
- [x] 聊天接口 `/api/chat`
- [x] 记忆搜索 `/api/memory/search`
- [x] 记忆统计 `/api/memory/stats`
- [x] 会话管理 `/api/sessions`
- [x] 定时任务 `/api/cron/tasks`

## 🧩 测试策略

### 持续集成
- 每次代码提交运行单元测试
- 验证构建过程
- 确保API兼容性

### 回归测试
- 确保新功能不影响现有功能
- 验证错误修复不会引入新问题
- 测试边界情况和异常处理

### 性能测试
- 响应时间验证
- 并发性能测试
- 内存使用监控

## 🔧 测试最佳实践

### 1. 测试驱动开发
- 为新功能编写测试用例
- 验证功能按预期工作
- 确保错误处理正确

### 2. 边界测试
- 测试空输入和无效数据
- 验证错误处理机制
- 测试极端情况

### 3. 集成验证
- 测试组件间交互
- 验证数据流正确性
- 确保API响应格式一致

## 🚀 测试流程

### 开发阶段
1. 编写功能代码
2. 编写对应测试
3. 运行单元测试
4. 修复发现的问题

### 提交前
1. 运行完整测试套件
2. 验证API端点
3. 确认服务器正常启动
4. 检查错误日志

### 部署前
1. 运行所有测试
2. 验证向量搜索功能
3. 测试定时任务系统
4. 确认配置加载正常

## 📈 测试指标

### 代码覆盖率
- 目标: >80% 行覆盖率
- 重点: 核心业务逻辑
- 监控: 每次提交后更新

### 性能指标
- API响应时间: <500ms
- 向量搜索时间: <100ms
- 并发支持: 100+ 连接

### 稳定性指标
- 测试通过率: 100%
- 服务器启动成功率: 100%
- 内存泄漏检测: 无泄漏

## 🔄 持续改进

### 自动化测试
- 集成CI/CD管道
- 自动化回归测试
- 性能基线监控

### 测试数据管理
- 真实数据样本
- 模拟用户行为
- 负载测试场景

---
*该测试系统确保Goclaw项目的质量、稳定性和可靠性*